---
version: "3"
services:
  kuma:
    image: louislam/uptime-kuma:1.22
    environment:
      - TZ=America/Chicago
    volumes:
      - kuma-db:/app/data
      - /var/run/docker.sock:/var/run/docker.sock:ro
    restart: always
    depends_on:
      - kuma-tailscale
    network_mode: service:kuma-tailscale
  kuma-tailscale:
    image: ghcr.io/elliotmatson/tailscale-sidecar-proxy:v0.0.13
    restart: always
    environment:
      TAILSCALE_AUTH_KEY: ${TS_AUTH_KEY:?err}
      TAILSCALE_HOSTNAME: status
      TAILSCALE_FUNNEL: true
      TAILSCALE_SERVE_PORT: 3001

  api:
    image: medaziz11/uptimekuma_restapi:latest
    volumes:
      - api-db:/db
    restart: always
    env_file:
      - stack.env
    depends_on:
      - kuma
      - api-tailscale
  api-tailscale:
    image: ghcr.io/elliotmatson/tailscale-sidecar-proxy:v0.0.13
    restart: always
    environment:
      TAILSCALE_AUTH_KEY: ${TS_AUTH_KEY:?err}
      TAILSCALE_HOSTNAME: kumaapi
      TAILSCALE_SERVE_PORT: 8000

volumes:
  kuma-db:
  api-db:
